generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Lieu {
  id           Int         @id @default(autoincrement())
  libelle      String
  adresse      String
  ville        String
  numero_salle String?
  evenements   Evenement[]
  representations Representation[]
  idCompagnie Int
  compagnie Compagnie @relation(fields: [idCompagnie], references: [id])
}

model Categorie {
  id         Int         @id @default(autoincrement())
  nom        String
  evenements Evenement[]
  idCompagnie Int
  compagnie Compagnie @relation(fields: [idCompagnie], references: [id])
}

model Compagnie {
  id    Int      @id @default(autoincrement())
  nom   String
  membres UtilisateurBouchon[]
  evenements Evenement[]
  categoriesEvenement Categorie[]
  lieuxEvenement Lieu[]
  spectacles Spectacle[] @relation("SpectaclesCompagnie")
  objets Objet[] @relation("ObjetsCompagnie")
}

model Evenement {
  id     Int      @id @default(autoincrement())
  nom    String
  compagnieId Int
  compagnie Compagnie @relation(fields: [compagnieId], references: [id])
  lieuId Int
  lieu   Lieu     @relation(fields: [lieuId], references: [id])
  categorieId Int
  categorie   Categorie     @relation(fields: [categorieId], references: [id])
  participants ParticipantsEvenement[]
  dateDebut DateTime
  dateFin DateTime
}


model ParticipantsEvenement {
  id     Int      @id @default(autoincrement())
  utilisateurId  Int
  utilisateur  UtilisateurBouchon  @relation(fields: [utilisateurId], references: [id])
  evenementId Int
  evenement Evenement @relation(fields: [evenementId],references: [id])
}


// TODO utiliser la vrai table des utilisateur
model UtilisateurBouchon {
  id    Int      @id @default(autoincrement())
  evenements  ParticipantsEvenement[]
  compagnieId Int?
  compagnie Compagnie? @relation(fields: [compagnieId], references: [id])
  droitModificationPlanification  Boolean @default(false)
}
// Partie groupe Communication
enum Role {
  COMEDIEN
  TECHNICIEN
  PARTENAIRE 
}

model Contact {
  id    Int     @id @default(autoincrement())
  nom String 
  prenom String
  role    Role?
  email String? @unique
  tel String? 
  date_creation DateTime @default(now())
}
// partie groupe production

enum StatutSpectacle {
  EN_CREATION
  EN_REPETITION
  EN_TOURNEE
  ARCHIVE
}

enum TypeSpectacle {
  THEATRE
  DANSE
  MUSIQUE
  CIRQUE
  AUTRE
}

enum TypeObjet {
  COSTUME
  DECOR
  MATERIEL_TECHNIQUE
  ACCESSOIRE
}

model Spectacle {
  id              Int              @id @default(autoincrement())
  titre           String
  description     String?
  type            TypeSpectacle
  statut          StatutSpectacle
  budget_initial  Float            @default(0)
  compagnieId     Int
  compagnie       Compagnie        @relation("SpectaclesCompagnie", fields: [compagnieId], references: [id])
  ficheTechnique  FicheTechnique?
  representations Representation[]
}

model FicheTechnique {
  id          Int       @id @default(autoincrement())
  texte       String
  spectacleId Int       @unique
  spectacle   Spectacle @relation(fields: [spectacleId], references: [id], onDelete: Cascade)
}

model Representation {
  id          Int               @id @default(autoincrement())
  date        DateTime
  spectacleId Int
  spectacle   Spectacle         @relation(fields: [spectacleId], references: [id], onDelete: Cascade)
  lieuId      Int
  lieu        Lieu              @relation(fields: [lieuId], references: [id])
  reservations ReservationObjet[]
}

model Objet {
  id            Int               @id @default(autoincrement())
  nom           String
  type          TypeObjet
  estDisponible Boolean           @default(true)
  compagnieId   Int
  compagnie     Compagnie         @relation("ObjetsCompagnie", fields: [compagnieId], references: [id])
  reservations  ReservationObjet[]
}

model ReservationObjet {
  id               Int            @id @default(autoincrement())
  quantite         Int
  objetId          Int
  objet            Objet          @relation(fields: [objetId], references: [id], onDelete: Cascade)
  representationId Int
  representation   Representation @relation(fields: [representationId], references: [id], onDelete: Cascade)
}

